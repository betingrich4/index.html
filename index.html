<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FootyLive ¬∑ free football streams</title>
    <!-- Tailwind (lightweight) + minimal custom style -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.17"></script>
    <style>
        body { background: #0a0c10; }
        .animate-fade { animation: fade 0.2s ease; }
        @keyframes fade { 0%{opacity:0;} 100%{opacity:1;} }
        .seek-slider { -webkit-appearance: none; height: 4px; background: #ffffff4d; border-radius: 999px; }
        .seek-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: #ef4444; border-radius: 999px; cursor: pointer; margin-top: -5px; }
        .seek-slider::-moz-range-thumb { width: 14px; height: 14px; background: #ef4444; border: none; border-radius: 999px; cursor: pointer; }
        .vol-slider { width: 70px; height: 4px; background: #ffffff4d; border-radius: 999px; }
    </style>
</head>
<body class="text-white">

<div id="app" class="min-h-screen flex flex-col"></div>

<script>
(function() {
    // ----- FOOTBALL-DEDICATED IPTV PLAYLISTS (public, auto‚Äëupdated) -----
    const PLAYLISTS = [
        { name: '‚öΩ Sports (streamed-su)', url: 'https://raw.githubusercontent.com/streamed-su/sports/main/playlist.m3u' },
        { name: 'üèÜ T-Sports (Bangladesh)', url: 'https://raw.githubusercontent.com/Shakib447/T-Sports-Playlist-Auto-Update/main/playlist.m3u' },
        { name: 'üåç IPTV-org football subset', url: 'https://iptv-org.github.io/iptv/categories/sports.m3u' }
    ];

    // ----- fallback demo matches (when networks fail) -----
    const DEMO_MATCHES = [
        { name: 'üî¥ [DEMO] Premier League Live', url: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8', thumbnail: 'premier' },
        { name: 'üî¥ [DEMO] UEFA Champions League', url: 'https://devstreaming-cdn.apple.com/videos/streaming/examples/bipbop_16x9/bipbop_16x9_variant.m3u8', thumbnail: 'ucl' },
        { name: 'üî¥ [DEMO] La Liga El Cl√°sico', url: 'https://moctobpltc-i.akamaihd.net/hls/live/571329/eight/playlist.m3u8', thumbnail: 'laliga' },
    ];

    // ----- state management (simple) -----
    let state = {
        matches: [],                 // array of { name, url, thumbnail?, group? }
        filteredMatches: [],
        leagues: [],
        selectedLeague: 'all',
        searchQuery: '',
        loading: true,
        error: null,
        // player
        currentMatch: null,
        playing: false,
        muted: false,
        volume: 80,
        currentTime: 0,
        duration: 0,
        showControls: true,
        streamError: false,
        buffering: false,
        fullscreen: false,
    };

    const listeners = [];
    function setState(upd) { state = { ...state, ...upd }; listeners.forEach(f => f()); }
    function subscribe(fn) { listeners.push(fn); return () => listeners = listeners.filter(l => l !== fn); }

    // helpers
    const formatTime = (sec) => {
        if (!isFinite(sec)) return '0:00';
        const h = Math.floor(sec / 3600), m = Math.floor((sec % 3600) / 60), s = Math.floor(sec % 60);
        return h ? `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}` : `${m}:${s.toString().padStart(2,'0')}`;
    };

    // ---- fetch & parse multiple playlists ----
    async function loadFootballStreams() {
        setState({ loading: true, error: null });
        let allMatches = [];
        for (const pl of PLAYLISTS) {
            try {
                console.log(`Fetching ${pl.name} ...`);
                const res = await fetch(pl.url, { mode: 'cors', cache: 'no-cache' });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const text = await res.text();
                const lines = text.split('\n');
                let groupMatches = [];
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].startsWith('#EXTINF')) {
                        let name = lines[i].split(',').pop()?.trim() || 'football stream';
                        // try to get logo from tvg-logo
                        const logoMatch = lines[i].match(/tvg-logo="([^"]+)"/);
                        const logo = logoMatch ? logoMatch[1] : null;
                        const urlLine = lines[i+1]?.replace(/\r/g,'').trim();
                        if (urlLine && (urlLine.startsWith('http'))) {
                            // filter only football related (heuristic)
                            const lower = name.toLowerCase();
                            if (lower.includes('football') || lower.includes('soccer') || lower.includes('premier') || 
                                lower.includes('laliga') || lower.includes('bundesliga') || lower.includes('serie a') ||
                                lower.includes('champions league') || lower.includes('europa') || lower.includes('world cup') ||
                                lower.includes('match') || lower.includes('live') || lower.includes('sport')) {
                                groupMatches.push({
                                    id: `footy-${Date.now()}-${i}`,
                                    name: name,
                                    url: urlLine,
                                    logo: logo,
                                    group: pl.name
                                });
                            }
                        }
                        i++; // skip url line
                    }
                }
                if (groupMatches.length > 0) {
                    allMatches = [...allMatches, ...groupMatches];
                } else {
                    // fallback: if playlist empty, maybe add demo match for that league
                    console.warn(`${pl.name} returned 0 matches, adding demo fallback`);
                }
            } catch (e) {
                console.warn(`Error loading ${pl.name}:`, e);
                // add demo fallback for this playlist so UI not empty
            }
        }

        // if almost empty, inject demo matches
        if (allMatches.length < 3) {
            allMatches = DEMO_MATCHES.map((d,idx) => ({ ...d, id: `demo-${idx}`, group: 'üì∫ Demo Matches' }));
        } else {
            // limit to avoid overload (max 80 matches)
            allMatches = allMatches.slice(0, 80);
        }

        // extract unique league/group names
        const leagueSet = new Set(allMatches.map(m => m.group).filter(Boolean));
        const leagues = ['all', ...Array.from(leagueSet)];

        setState({ 
            matches: allMatches, 
            filteredMatches: allMatches,
            leagues,
            loading: false,
            selectedLeague: 'all'
        });
    }

    // filter by league & search
    function filterMatches() {
        let filtered = state.matches;
        if (state.selectedLeague !== 'all') {
            filtered = filtered.filter(m => m.group === state.selectedLeague);
        }
        if (state.searchQuery.trim()) {
            const q = state.searchQuery.toLowerCase();
            filtered = filtered.filter(m => m.name.toLowerCase().includes(q));
        }
        setState({ filteredMatches: filtered });
    }

    // ----- player refs & logic -----
    let videoElement = null;
    let hlsInstance = null;

    function playMatch(match) {
        if (!match) return;
        // close current stream
        if (videoElement) {
            videoElement.pause();
            videoElement.src = '';
            if (hlsInstance) { hlsInstance.destroy(); hlsInstance = null; }
        }
        setState({ 
            currentMatch: match, 
            playing: false, 
            buffering: true, 
            streamError: false,
            currentTime: 0,
            duration: 0
        });
    }

    function closePlayer() {
        if (videoElement) {
            videoElement.pause(); videoElement.src = ''; 
            if (hlsInstance) { hlsInstance.destroy(); hlsInstance = null; }
        }
        setState({ currentMatch: null, playing: false });
    }

    // fullscreen
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else {
            document.exitFullscreen();
        }
    }

    // ----- UI components (return HTML string) -----
    function Header() {
        return `
            <nav class="fixed w-full top-0 z-40 bg-slate-950/90 backdrop-blur-sm border-b border-slate-800">
                <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
                    <div class="flex items-center gap-2 text-xl font-bold">
                        <span class="text-2xl">‚öΩ</span>
                        <span class="bg-gradient-to-r from-emerald-500 to-green-500 bg-clip-text text-transparent">FootyLive</span>
                        <span class="text-xs bg-red-600/20 text-red-400 px-2 py-0.5 rounded-full ml-2">free streams</span>
                    </div>
                    <div class="text-sm text-slate-400">${state.matches.length} football channels</div>
                </div>
            </nav>
        `;
    }

    function LeagueFilter() {
        const leagueOptions = state.leagues.map(l => {
            const display = l === 'all' ? 'üèÅ All leagues' : l.replace(/[‚öΩüèÜüåç]/g,'').trim();
            return `<option value="${l}" ${state.selectedLeague === l ? 'selected' : ''}>${display}</option>`;
        }).join('');
        return `
            <div class="flex flex-wrap gap-3 items-center">
                <select onchange="window.footyLeague(this.value)" class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-green-600">
                    ${leagueOptions}
                </select>
                <div class="relative flex-1 max-w-xs">
                    <input type="text" placeholder="Search matches..." value="${state.searchQuery}" oninput="window.footySearch(this.value)" class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-9 pr-3 py-2 text-sm focus:outline-none focus:border-green-600">
                    <svg class="absolute left-3 top-2.5 w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                </div>
            </div>
        `;
    }

    function MatchGrid() {
        if (state.loading) {
            return `<div class="flex justify-center py-20"><div class="w-10 h-10 border-4 border-green-600 border-t-transparent rounded-full animate-spin"></div></div>`;
        }
        const items = state.filteredMatches.map(m => {
            const thumbnail = m.logo || (m.thumbnail ? `https://dummyimage.com/300x180/0f5132/fff&text=‚öΩ+${encodeURIComponent(m.name.substring(0,20))}` : `https://dummyimage.com/300x180/1e293b/aaa&text=‚öΩ+match`);
            return `
                <div class="group bg-slate-800/60 rounded-xl overflow-hidden border border-slate-700 hover:border-green-700 transition-all hover:scale-[1.01] cursor-pointer" onclick="window.footyPlay('${encodeURIComponent(JSON.stringify(m))}')">
                    <div class="aspect-video bg-slate-700 relative">
                        <img src="${thumbnail}" alt="${m.name}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition" loading="lazy" onerror="this.onerror=null; this.src='https://dummyimage.com/300x180/1e293b/eee&text=‚öΩ';">
                        <div class="absolute top-2 right-2 bg-black/70 text-green-400 text-xs px-2 py-1 rounded-full border border-green-800">LIVE</div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold text-sm md:text-base line-clamp-2 group-hover:text-green-400">${m.name}</h3>
                        <p class="text-xs text-slate-400 mt-1">${m.group?.replace(/[‚öΩüèÜüåç]/g,'') || 'football'}</p>
                    </div>
                </div>
            `;
        }).join('');
        return `
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="mb-4">${LeagueFilter()}</div>
                ${items.length === 0 ? '<div class="text-center py-16 text-slate-500">No football streams match ‚Äî try another filter</div>' : `<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4">${items}</div>`}
            </div>
        `;
    }

    function VideoPlayer() {
        if (!state.currentMatch) return '';
        const m = state.currentMatch;
        const played = (state.currentTime / (state.duration || 1)) * 100;
        return `
            <div class="fixed inset-0 bg-black z-50 flex flex-col animate-fade">
                <video id="footy-video" class="w-full h-full object-contain" autoplay playsinline></video>
                ${state.buffering ? `
                    <div class="absolute inset-0 flex items-center justify-center bg-black/60">
                        <div class="flex flex-col items-center gap-3"><div class="w-12 h-12 border-4 border-green-600 border-t-transparent rounded-full animate-spin"></div><p class="text-sm text-slate-300">loading stream ...</p></div>
                    </div>` : ''}
                ${state.streamError ? `
                    <div class="absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm">
                        <div class="bg-slate-900 p-6 rounded-xl max-w-sm text-center border border-red-800">
                            <span class="text-4xl mb-3">‚öΩ‚ùå</span>
                            <h3 class="text-xl font-bold mb-2">Stream offline</h3>
                            <p class="text-slate-400 text-sm mb-4">This football link may be geo-blocked or expired.</p>
                            <button onclick="window.footyClose()" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-full text-sm font-semibold">back to matches</button>
                        </div>
                    </div>` : ''}
                ${state.showControls ? `
                <div class="absolute top-0 left-0 right-0 bg-gradient-to-b from-black/70 to-transparent p-4">
                    <button onclick="window.footyClose()" class="text-white hover:bg-white/10 p-2 rounded-full transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    </button>
                </div>
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/90 to-transparent p-4">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-sm font-medium truncate max-w-[60%]">${m.name}</span>
                    </div>
                    <div class="relative h-1 bg-white/30 rounded-full mb-2 cursor-pointer" onclick="window.footySeek(event)">
                        <div class="absolute h-full bg-green-600 rounded-full" style="width:${played}%"></div>
                        <div class="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-green-600 rounded-full opacity-0 group-hover:opacity-100 transition" style="left:${played}%"></div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center gap-3">
                            <button onclick="window.footyTogglePlay()" class="text-white hover:bg-white/10 p-2 rounded-full">
                                ${state.playing ? '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>' : '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>'}
                            </button>
                            <button onclick="window.footyMute()" class="text-white hover:bg-white/10 p-2 rounded-full">
                                ${state.muted || state.volume===0 ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 5L6 9H3v6h3l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>' : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 5L6 9H3v6h3l5 4V5z"/><path d="M19 9a6 6 0 0 1 0 6"/></svg>'}
                            </button>
                            <input type="range" min="0" max="100" value="${state.muted ? 0 : state.volume}" oninput="window.footyVolume(this.value)" class="vol-slider accent-green-600">
                            <span class="text-white/70 text-xs font-mono">${formatTime(state.currentTime)} / ${formatTime(state.duration)}</span>
                        </div>
                        <button onclick="window.footyFullscreen()" class="text-white hover:bg-white/10 p-2 rounded-full">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"/></svg>
                        </button>
                    </div>
                </div>` : ''}
            </div>
        `;
    }

    function Footer() {
        return `
            <footer class="mt-auto border-t border-slate-800 bg-slate-950/50 py-6 px-4 text-center text-xs text-slate-600">
                FootyLive ¬∑ free football streams from public playlists ¬∑ for educational purposes
            </footer>
        `;
    }

    // ----- render -----
    function render() {
        const app = document.getElementById('app');
        if (!app) return;
        app.innerHTML = `
            ${Header()}
            <main class="flex-1 pt-14">
                ${!state.currentMatch ? MatchGrid() : ''}
            </main>
            ${!state.currentMatch ? Footer() : ''}
            ${VideoPlayer()}
        `;
        // video event binding if player open
        if (state.currentMatch) {
            const v = document.getElementById('footy-video');
            if (v) {
                videoElement = v;
                const m = state.currentMatch;
                if (m.url.includes('.m3u8')) {
                    if (Hls.isSupported()) {
                        if (hlsInstance) hlsInstance.destroy();
                        hlsInstance = new Hls();
                        hlsInstance.loadSource(m.url);
                        hlsInstance.attachMedia(v);
                    } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
                        v.src = m.url;
                    } else {
                        setState({ streamError: true, buffering: false });
                    }
                } else {
                    v.src = m.url;
                }
                v.volume = state.muted ? 0 : state.volume / 100;
                v.muted = state.muted;

                const onLoad = () => {
                    setState({ buffering: false, duration: v.duration });
                    v.play().catch(()=>{}).then(()=> setState({playing: true}));
                };
                v.addEventListener('loadeddata', onLoad, { once: true });
                v.addEventListener('error', () => setState({ streamError: true, buffering: false }));
                v.addEventListener('waiting', () => setState({ buffering: true }));
                v.addEventListener('playing', () => setState({ buffering: false, playing: true }));
                v.addEventListener('timeupdate', () => setState({ currentTime: v.currentTime }));
                v.addEventListener('durationchange', () => setState({ duration: v.duration }));
                v.addEventListener('pause', () => setState({ playing: false }));
                v.addEventListener('play', () => setState({ playing: true }));
            }
        }
    }

    // global handlers
    window.footyLeague = (l) => { setState({ selectedLeague: l }); filterMatches(); };
    window.footySearch = (q) => { setState({ searchQuery: q }); filterMatches(); };
    window.footyPlay = (str) => {
        try {
            const m = JSON.parse(decodeURIComponent(str));
            playMatch(m);
        } catch (e) { alert('Invalid match'); }
    };
    window.footyClose = closePlayer;
    window.footyTogglePlay = () => { if (videoElement) videoElement.paused ? videoElement.play() : videoElement.pause(); };
    window.footyMute = () => { if (videoElement) videoElement.muted = !videoElement.muted; setState({ muted: videoElement.muted }); };
    window.footyVolume = (val) => { 
        if (videoElement) videoElement.volume = val/100; 
        setState({ volume: parseInt(val,10), muted: val == 0 }); 
    };
    window.footySeek = (e) => {
        if (!videoElement || !state.duration) return;
        const rect = e.currentTarget.getBoundingClientRect();
        const ratio = (e.clientX - rect.left) / rect.width;
        videoElement.currentTime = ratio * state.duration;
    };
    window.footyFullscreen = toggleFullscreen;
    window.addEventListener('fullscreenchange', () => setState({ fullscreen: !!document.fullscreenElement }));

    // mousemove show controls
    let hideTimer;
    document.addEventListener('mousemove', () => {
        if (state.currentMatch) {
            setState({ showControls: true });
            clearTimeout(hideTimer);
            hideTimer = setTimeout(() => setState({ showControls: false }), 2500);
        }
    });

    // init
    subscribe(render);
    loadFootballStreams();
})();
</script>
</body>
</html>
